const k=document.getElementById("search-index"),C=document.querySelector("[data-search-results]"),E=document.querySelector("[data-search-count]"),N=document.querySelector("[data-search-empty]"),p=Array.from(document.querySelectorAll("[data-search-category]")),$=Array.from(document.querySelectorAll("[data-search-form]")),f=Array.from(document.querySelectorAll("[data-search-input]"));if(k&&C&&E){let b=function(){const e=new URLSearchParams(window.location.search);l?e.set("q",l):e.delete("q"),r?e.set("category",r):e.delete("category");const a=`${window.location.pathname}${e.toString()?`?${e.toString()}`:""}${window.location.hash}`;window.history.replaceState({},"",a)},i=function(){const e=d(l.trim()),a=M.filter(t=>{const c=!r||t.categorySlug===r,o=!e||d(t.title).includes(e)||d(t.excerpt||"").includes(e)||Array.isArray(t.tags)&&t.tags.some(s=>d(s).includes(e));return c&&o});L(a),b()},L=function(e){if(x.innerHTML="",!e.length){v?.classList.remove("hidden"),y.textContent="No articles match that search yet.";return}v?.classList.add("hidden"),y.textContent=`Showing ${e.length} ${e.length===1?"result":"results"}.`;const a=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"});e.slice(0,20).forEach(t=>{const c=document.createElement("article");c.className="flex gap-4 p-4 border border-gray-200 dark:border-slate-700 rounded-xl hover:shadow-lg transition bg-white dark:bg-slate-800",c.setAttribute("aria-label",`Result: ${t.title}`);const o=document.createElement("div");if(t.image){o.className="w-28 h-28 rounded-lg overflow-hidden bg-gray-200 dark:bg-slate-700 flex-shrink-0";const n=document.createElement("img");n.src=t.image,n.alt=t.title,n.loading="lazy",n.decoding="async",n.className="w-full h-full object-cover",o.appendChild(n),c.appendChild(o)}const s=document.createElement("div");s.className="flex-1 space-y-2";const g=document.createElement("div");g.className="flex flex-wrap items-center gap-3 text-xs uppercase tracking-wide text-brand-accent font-semibold",g.innerHTML=`
            <span class="inline-flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M4 6h16"></path>
                <path d="M4 12h16"></path>
                <path d="M4 18h16"></path>
              </svg>
              ${t.category}
            </span>
            <span class="inline-flex items-center gap-2 text-xs text-muted dark:text-slate-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M12 6v6l4 2"></path>
                <circle cx="12" cy="12" r="9"></circle>
              </svg>
              ${a.format(new Date(t.publishDate))}
            </span>
          `;const h=document.createElement("a");h.href=t.permalink,h.textContent=t.title,h.className="block text-lg font-bold text-gray-900 dark:text-white hover:text-brand-accent dark:hover:text-brand-accent-light transition";const u=document.createElement("p");u.textContent=t.excerpt||"",u.className="text-sm text-muted dark:text-slate-300 line-clamp-2";const m=document.createElement("div");if(m.className="flex flex-wrap items-center gap-2 text-xs text-muted dark:text-slate-400",t.readingTime){const n=document.createElement("span");n.className="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-slate-700 rounded-full",n.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 6v6l4 2"></path><circle cx="12" cy="12" r="9"></circle></svg> ${t.readingTime} min read`,m.appendChild(n)}if(t.tags?.length){const n=document.createElement("span");n.className="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-slate-700 rounded-full",n.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7h10v10h-10z"></path></svg> ${t.tags.slice(0,2).join(", ")}`,m.appendChild(n)}s.appendChild(g),s.appendChild(h),t.excerpt&&s.appendChild(u),s.appendChild(m),c.appendChild(s),x.appendChild(c)})},S=function(e){f.forEach(a=>{a!==e&&(a.value=e.value)})};const M=JSON.parse(k.textContent||"[]"),w=new URLSearchParams(window.location.search);let r=w.get("category")||"",l=w.get("q")||"";const x=C,y=E,v=N;f.forEach(e=>{e.value=l});const d=(e="")=>e.toLowerCase();f.forEach(e=>{e.addEventListener("input",a=>{const t=a.target;t&&(l=t.value,S(t),i())})}),$.forEach(e=>{e.addEventListener("submit",a=>{a.preventDefault(),i()})}),p.forEach(e=>{e.dataset.searchCategory===r&&e.classList.add("bg-brand-accent","text-white"),e.addEventListener("click",()=>{r=r===e.dataset.searchCategory?"":e.dataset.searchCategory||"",p.forEach(a=>a.classList.toggle("bg-brand-accent",a.dataset.searchCategory===r)),p.forEach(a=>a.classList.toggle("text-white",a.dataset.searchCategory===r)),i()})}),i()}
