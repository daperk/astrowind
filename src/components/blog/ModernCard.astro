---
import type { ImageMetadata } from 'astro';
import { APP_BLOG } from 'astrowind:config';
import type { Post } from '~/types';

import Image from '~/components/common/Image.astro';
import PostTags from '~/components/blog/Tags.astro';
import { Icon } from 'astro-icon/components';

import { findImage } from '~/utils/images';
import { getPermalink } from '~/utils/permalinks';
import { getFormattedDate } from '~/utils/utils';

export interface Props {
  post: Post;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const image = (await findImage(post.image)) as ImageMetadata | undefined;

const link = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

{featured ? (
  <!-- Featured Hero Post -->
  <article class="group relative overflow-hidden rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 mb-12 lg:mb-16">
    <a href={link} class="block">
      <!-- Image -->
      <div class="relative h-[400px] md:h-[500px] lg:h-[600px] overflow-hidden bg-gray-900">
        {image && (
          <Image
            src={image}
            class="absolute inset-0 w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"
            widths={[400, 768, 1024, 1280]}
            sizes="(max-width: 768px) 100vw, (max-width: 1024px) 100vw, 1280px"
            alt={post.title}
            loading="eager"
            decoding="async"
          />
        )}
        <!-- Gradient overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
      </div>

      <!-- Content overlay -->
      <div class="absolute bottom-0 left-0 right-0 p-6 md:p-8 lg:p-12 text-white">
        <!-- Meta -->
        <div class="flex flex-wrap items-center gap-3 mb-4 text-sm">
          {post.category && (
            <span class="inline-block px-3 py-1 bg-brand-accent text-white rounded-full font-medium text-xs uppercase tracking-wide">
              {post.category.title}
            </span>
          )}
          <span class="flex items-center gap-1">
            <Icon name="tabler:clock" class="w-4 h-4" />
            <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
          </span>
          {post.readingTime && (
            <span class="flex items-center gap-1">
              <Icon name="tabler:book" class="w-4 h-4" />
              {post.readingTime} min read
            </span>
          )}
        </div>

        <!-- Title -->
        <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-4 group-hover:text-brand-accent-light transition-colors">
          {post.title}
        </h2>

        <!-- Excerpt -->
        {post.excerpt && (
          <p class="text-lg md:text-xl text-gray-200 line-clamp-2 max-w-3xl">
            {post.excerpt}
          </p>
        )}
      </div>
    </a>
  </article>
) : (
  <!-- Regular Card -->
  <article class="group h-full flex flex-col bg-white dark:bg-slate-800 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden">
    <a href={link} class="block">
      <!-- Image -->
      <div class="relative h-48 md:h-56 overflow-hidden bg-gray-400 dark:bg-slate-700">
        {image && (
          <Image
            src={image}
            class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500"
            widths={[400, 600]}
            sizes="(max-width: 768px) 400px, 600px"
            alt={post.title}
            aspectRatio="16:9"
            loading="lazy"
            decoding="async"
          />
        )}
        <!-- Category badge -->
        {post.category && (
          <div class="absolute top-4 left-4">
            <span class="inline-block px-3 py-1 bg-brand-accent text-white rounded-full font-medium text-xs uppercase tracking-wide shadow-lg">
              {post.category.title}
            </span>
          </div>
        )}
      </div>

      <!-- Content -->
      <div class="p-6 flex-1 flex flex-col">
        <!-- Meta -->
        <div class="flex flex-wrap items-center gap-3 mb-3 text-sm text-muted">
          <span class="flex items-center gap-1">
            <Icon name="tabler:clock" class="w-3.5 h-3.5" />
            <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
          </span>
          {post.readingTime && (
            <span class="flex items-center gap-1">
              <Icon name="tabler:book" class="w-3.5 h-3.5" />
              {post.readingTime} min
            </span>
          )}
        </div>

        <!-- Title -->
        <h3 class="text-xl font-bold leading-tight mb-3 group-hover:text-brand-accent dark:group-hover:text-brand-accent-light transition-colors line-clamp-2">
          {post.title}
        </h3>

        <!-- Excerpt -->
        {post.excerpt && (
          <p class="text-muted dark:text-slate-400 line-clamp-3 mb-4 flex-1">
            {post.excerpt}
          </p>
        )}

        <!-- Read more -->
        <div class="flex items-center gap-2 text-brand-accent dark:text-brand-accent-light font-medium text-sm group-hover:gap-3 transition-all">
          Read more
          <Icon name="tabler:arrow-right" class="w-4 h-4" />
        </div>
      </div>
    </a>
  </article>
)}
